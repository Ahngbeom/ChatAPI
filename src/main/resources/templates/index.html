<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MBTI Chat</title>
    <link href="/webjars/bootstrap/5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="/webjars/bootstrap/5.1.3/dist/js/bootstrap.min.js"></script>
    <script src="/webjars/jquery/3.6.0/jquery.min.js"></script>
    <script src="/webjars/sockjs-client/dist/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/2.3.4/stomp.min.js"></script>
</head>
<body>

<div class="container-fluid">
    <div class="d-flex flex-column">
        <div class="d-flex flex-column">
            <h2 class="d-flex justify-content-center">Myers-Briggs Type Indicator</h2>
            <h1 class="d-flex justify-content-center">M B T I</h1>
            <hr>
        </div>
        <div class="d-flex flex-column border border-1 border-secondary m-2">
            <h3 class="d-flex justify-content-center">당신은 외향적입니까? 내향적입니까?</h3>
            <div class="d-flex justify-content-center">
                <div class="form-check-inline m-2">
                    <input class="form-check-input" type="radio" name="focused" id="focusedExtraversion">
                    <label class="form-check-label" for="focusedExtraversion">
                        외향적(Extraversion)
                    </label>
                </div>
                <div class="form-check-inline m-2">
                    <input class="form-check-input" type="radio" name="focused" id="focusedIntroversion">
                    <label class="form-check-label" for="focusedIntroversion">
                        내향적(Introversion)
                    </label>
                </div>
            </div>
        </div>

        <div class="d-flex flex-column border border-1 border-secondary m-2">
            <h3 class="d-flex justify-content-center">당신의 인식 방식은 어떠합니까?</h3>
            <div class="d-flex justify-content-center">
                <div class="form-check-inline m-2">
                    <input class="form-check-input" type="radio" name="recognition" id="recognitionSensing">
                    <label class="form-check-label" for="recognitionSensing">
                        감각적(Sensing)
                    </label>
                </div>
                <div class="form-check-inline m-2">
                    <input class="form-check-input" type="radio" name="recognition" id="recognitionIntuition">
                    <label class="form-check-label" for="recognitionIntuition">
                        직관적(Intuition)
                    </label>
                </div>
            </div>
        </div>

        <div class="d-flex flex-column border border-1 border-secondary m-2">
            <h3 class="d-flex justify-content-center">당신의 판단 방식은 어떠합니까?</h3>
            <div class="d-flex justify-content-center">
                <div class="form-check-inline m-2">
                    <input class="form-check-input" type="radio" name="decision" id="decisionThinking">
                    <label class="form-check-label" for="decisionThinking">
                        사고(Thinking)
                    </label>
                </div>
                <div class="form-check-inline m-2">
                    <input class="form-check-input" type="radio" name="decision" id="decisionFeeling">
                    <label class="form-check-label" for="decisionFeeling">
                        감정(Feeling)
                    </label>
                </div>
            </div>
        </div>

        <div class="d-flex flex-column border border-1 border-secondary m-2">
            <h3 class="d-flex justify-content-center">당신의 대처 방식은 어떠합니까?</h3>
            <div class="d-flex justify-content-center">
                <div class="form-check-inline m-2">
                    <input class="form-check-input" type="radio" name="coping" id="copingJudging">
                    <label class="form-check-label" for="copingJudging">
                        판단(Judging)
                    </label>
                </div>
                <div class="form-check-inline m-2">
                    <input class="form-check-input" type="radio" name="coping" id="copingPerceiving">
                    <label class="form-check-label" for="copingPerceiving">
                        인식(Perceiving)
                    </label>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-center">
            <button class="btn btn-secondary" onclick="MBTISubmit()">등록</button>
        </div>

        <div id="result">

        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
         aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Modal title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Submit</button>
                </div>
            </div>
        </div>
    </div>

</div>


</body>
</html>

<script type="application/javascript">

    const myModal = new bootstrap.Modal(document.getElementById('staticBackdrop'), {});

    let mbtiJson = {
        'focused': null,
        'recognition': null,
        'decision': null,
        'coping': null
    }

    function mbtiResultConverter(jsonData) {
        let result = "";
        $.each(jsonData, function (key, value) {
            switch (key) {
                case "focused":
                    console.log(value);
                    if (value === "Extraversion")
                        result += "E";
                    else
                        result += "I";
                    break;
                case "recognition":
                    if (value === "Sensing")
                        result += "S";
                    else
                        result += "N";
                    break;
                case "decision":
                    if (value === "Thinking")
                        result += "T";
                    else
                        result += "F";
                    break;
                case "coping":
                    if (value === "Judging")
                        result += "J";
                    else
                        result += "P";
                    break;
                default:
                    alert("mbtiResultConverter Error");
                    break;
            }
        });
        return result;
    }

    const MBTISubmit = function () {
        getRadioValue("focused");
        getRadioValue("recognition");
        getRadioValue("decision");
        getRadioValue("coping");

        let isComplete = true;
        $.each(mbtiJson, function (key, value) {
            if (value === null) {
                alert("Did not selected something");
                return (isComplete = false);
            }
        });

        console.log(mbtiJson, isComplete);

        let MBTIInfo = {};

        if (isComplete) {
            const mbtiResult = mbtiResultConverter(mbtiJson);
            console.log(mbtiResult);
            $.ajax({
                type: 'GET',
                url: "https://www.16personalities.com/" + mbtiResult + "-personality",
                success: function (data, status, xhr) {
                    let mbtiHeaderExtractByOfficialSite = $($.parseHTML(data)).find("header")[0];
                    document.querySelector("#staticBackdrop .modal-body").innerHTML = "<a href='https://www.16personalities.com/" + mbtiResult + "-personality'>Source</a>";
                    document.querySelector("#staticBackdrop .modal-body").append(mbtiHeaderExtractByOfficialSite.querySelector("img"));
                    document.querySelector("#staticBackdrop .modal-header #staticBackdropLabel").innerHTML = mbtiHeaderExtractByOfficialSite.querySelector("span").innerHTML;
                    document.querySelector("#staticBackdrop .modal-header #staticBackdropLabel").append(mbtiHeaderExtractByOfficialSite.querySelector("div[class='code']"));

                    let mbtiArticleExtractByOfficialSite = $($.parseHTML(data)).find("article")[0];
                    console.log(mbtiArticleExtractByOfficialSite);
                    document.querySelector("#staticBackdrop .modal-body").append(mbtiArticleExtractByOfficialSite);

                    myModal.show();

                    $.each($($.parseHTML(data)).filter(".type-info"), function (i, el) {
                        console.log(el);
                        // if (el.nodeName === "TITLE") {
                        //     console.log(el.text.replace("| 16Personalities", "").trim());
                        //     console.log(el.text);
                        // }
                    });
                },
                error: function (data, status, xhr) {
                    console.log(data);
                }
            });
        }
    }

    const getRadioValue = function (topic) {
        document.querySelectorAll(".form-check-input[name='" + topic + "']").forEach(input => {
            if (input.checked)
                mbtiJson[topic] = input.getAttribute('id').substring(input.getAttribute('name').length);
            else
                return false;

            removeEventListener('change', radioChangeEventCallback);
            input.addEventListener('change', radioChangeEventCallback);
        });
    }

    function radioChangeEventCallback() {
        MBTISubmit();
    }


</script>